from whoosh.index import create_in, open_dir
from whoosh.fields import Schema, TEXT, ID
from whoosh.qparser import QueryParser

# Creating the schema for the index
schema = Schema(id=ID(stored=True), content=TEXT(stored=True))

# Creating the index or opening an existing index
index_dir = 'path_to_index_directory'
index = None

try:
    index = open_dir(index_dir)
    print("Opening existing index...")
except:
    index = create_in(index_dir, schema)
    print("Creating new index...")

# Creating a writer to add documents to the index
writer = index.writer()

# Indexing documents
documents = [
    {"id": "1", "content": "This is the first document"},
    {"id": "2", "content": "This is the second document"},
    {"id": "3", "content": "This is the third document"},
]

for doc in documents:
    writer.add_document(id=str(doc["id"]), content=doc["content"])

writer.commit()

# Searching the index
search_term = "first document"
searcher = index.searcher()
query_parser = QueryParser("content", schema=schema)
query = query_parser.parse(search_term)

results = searcher.search(query)
print(f"Found {len(results)} results for '{search_term}':")

for result in results:
    print(f"ID: {result['id']} | Content: {result['content']}")
